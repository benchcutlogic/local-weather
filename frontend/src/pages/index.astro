---
import Layout from "../layouts/Layout.astro";
import { CITIES, metersToFeet } from "../lib/cities";
---

<Layout title="Hyperlocal Weather Forecasts">
  <div class="text-center mb-10">
    <h1 class="text-4xl md:text-5xl font-bold text-wx-900 mb-3">
      Mountain Weather, Decoded
    </h1>
    <p class="text-lg text-wx-700 max-w-2xl mx-auto">
      Multi-model forecasts with terrain-aware AI analysis. Know what's happening
      at every elevation band — from the valley floor to the peaks.
    </p>
  </div>

  <!-- Search -->
  <div class="max-w-md mx-auto mb-10">
    <div class="relative">
      <svg
        class="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-wx-400"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
      >
        <circle cx="11" cy="11" r="8" />
        <path d="m21 21-4.35-4.35" />
      </svg>
      <input
        id="city-search"
        type="text"
        placeholder="Search cities..."
        class="w-full pl-10 pr-4 py-3 rounded-xl border border-wx-200 bg-white shadow-sm
               focus:outline-none focus:ring-2 focus:ring-wx-500 focus:border-transparent
               text-wx-900 placeholder-wx-400"
      />
    </div>
  </div>

  <!-- City Cards -->
  <div id="city-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
    {
      CITIES.map((city) => (
        <a
          href={`/${city.slug}`}
          class="city-card group block bg-white rounded-xl shadow-sm border border-wx-100
                 hover:shadow-md hover:border-wx-300 transition-all duration-200"
          data-name={city.name.toLowerCase()}
          data-slug={city.slug}
        >
          <div class="p-6">
            <div class="flex items-start justify-between mb-3">
              <div>
                <h2 class="text-xl font-bold text-wx-900 group-hover:text-wx-600 transition-colors">
                  {city.name}, {city.state}
                </h2>
                <p class="text-sm text-wx-500 mt-0.5">
                  {city.lat.toFixed(2)}°N, {Math.abs(city.lon).toFixed(2)}°W
                </p>
              </div>
              <svg
                class="w-5 h-5 text-wx-300 group-hover:text-wx-500 transition-colors mt-1"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
              </svg>
            </div>

            <div class="flex flex-wrap gap-1.5">
              {city.elevBands.map((band) => (
                <span class="inline-block px-2 py-0.5 bg-wx-50 text-wx-700 text-xs rounded-full font-medium">
                  {metersToFeet(band).toLocaleString()} ft
                </span>
              ))}
            </div>

            <div class="mt-4 pt-3 border-t border-wx-50">
              <p class="text-sm text-wx-500">
                {city.elevBands.length} elevation bands tracked
              </p>
              <p class="text-xs text-wx-400 mt-1">HRRR + GFS + NAM + ECMWF</p>
            </div>
          </div>
        </a>
      ))
    }
  </div>

  <!-- How It Works -->
  <section class="mt-16 mb-8">
    <h2 class="text-2xl font-bold text-wx-900 text-center mb-8">How It Works</h2>
    <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
      <div class="text-center">
        <div
          class="w-12 h-12 bg-wx-100 rounded-xl flex items-center justify-center mx-auto mb-3"
        >
          <svg class="w-6 h-6 text-wx-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"
            />
          </svg>
        </div>
        <h3 class="font-semibold text-wx-900">Multi-Model Ingestion</h3>
        <p class="text-sm text-wx-600 mt-1">
          HRRR, GFS, NAM, and ECMWF data ingested every cycle via byte-range GRIB2 parsing.
        </p>
      </div>
      <div class="text-center">
        <div
          class="w-12 h-12 bg-wx-100 rounded-xl flex items-center justify-center mx-auto mb-3"
        >
          <svg class="w-6 h-6 text-wx-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"
            />
          </svg>
        </div>
        <h3 class="font-semibold text-wx-900">Drift & Verification</h3>
        <p class="text-sm text-wx-600 mt-1">
          Run-to-run drift tracking shows where models are trending. RTMA verification scores which model wins.
        </p>
      </div>
      <div class="text-center">
        <div
          class="w-12 h-12 bg-wx-100 rounded-xl flex items-center justify-center mx-auto mb-3"
        >
          <svg class="w-6 h-6 text-wx-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"
            />
          </svg>
        </div>
        <h3 class="font-semibold text-wx-900">AI Commentary</h3>
        <p class="text-sm text-wx-600 mt-1">
          Gemini generates terrain-aware commentary — like having a local weather expert for every city.
        </p>
      </div>
    </div>
  </section>

  <!-- Subscribe CTA -->
  <section id="subscribe" class="bg-wx-900 text-white rounded-2xl p-8 text-center">
    <h2 class="text-2xl font-bold mb-2">Get Premium Forecasts</h2>
    <p class="text-wx-200 mb-6 max-w-lg mx-auto">
      Detailed model comparison charts, extended elevation breakdowns, push alerts for
      significant drift, and early access to new cities.
    </p>
    <a
      href="https://buy.stripe.com/your_link_here"
      class="inline-block bg-white text-wx-900 px-6 py-3 rounded-lg font-semibold
             hover:bg-wx-50 transition-colors"
    >
      Subscribe — $5/month
    </a>
  </section>

  <script>
    const search = document.getElementById("city-search") as HTMLInputElement;
    const cards = document.querySelectorAll(".city-card");

    search?.addEventListener("input", () => {
      const q = search.value.toLowerCase().trim();
      cards.forEach((card) => {
        const el = card as HTMLElement;
        const name = el.dataset.name || "";
        const slug = el.dataset.slug || "";
        const match = !q || name.includes(q) || slug.includes(q);
        el.style.display = match ? "" : "none";
      });
    });
  </script>
</Layout>
